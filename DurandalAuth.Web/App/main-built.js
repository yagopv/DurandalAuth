/**
 * almond 0.2.0 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

(function(){var e,t,n;(function(r){function o(e,t){var n,r,o,i,a,s,l,c,u,d,f=t&&t.split("/"),v=w.map,p=v&&v["*"]||{};if(e&&"."===e.charAt(0)&&t){for(f=f.slice(0,f.length-1),e=f.concat(e.split("/")),c=0;e.length>c;c+=1)if(d=e[c],"."===d)e.splice(c,1),c-=1;else if(".."===d){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((f||p)&&v){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),f)for(u=f.length;u>0;u-=1)if(o=v[f.slice(0,u).join("/")],o&&(o=o[r])){i=o,a=c;break}if(i)break;!s&&p&&p[r]&&(s=p[r],l=c)}!i&&s&&(i=s,a=l),i&&(n.splice(0,a,i),e=n.join("/"))}return e}function i(e,t){return function(){return v.apply(r,y.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return o(t,e)}}function s(e){return function(t){h[e]=t}}function l(e){if(g.hasOwnProperty(e)){var t=g[e];delete g[e],b[e]=!0,f.apply(r,t)}if(!h.hasOwnProperty(e)&&!b.hasOwnProperty(e))throw Error("No "+e);return h[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(t,n,r){e.onResourceLoad&&t&&e.onResourceLoad({defined:n},{id:t},r)}function d(e){return function(){return w&&w.config&&w.config[e]||{}}}var f,v,p,m,h={},g={},w={},b={},y=[].slice;p=function(e,t){var n,r=c(e),i=r[0];return e=r[1],i&&(i=o(i,t),n=l(i)),i?e=n&&n.normalize?n.normalize(e,a(t)):o(e,t):(e=o(e,t),r=c(e),i=r[0],e=r[1],i&&(n=l(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},m={require:function(e){return i(e)},exports:function(e){var t=h[e];return t!==void 0?t:h[e]={}},module:function(e){return{id:e,uri:"",exports:h[e],config:d(e)}}},f=function(e,t,n,o){var a,c,d,f,v,w,y=[];if(o=o||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,v=0;t.length>v;v+=1)if(f=p(t[v],o),c=f.f,"require"===c)y[v]=m.require(e);else if("exports"===c)y[v]=m.exports(e),w=!0;else if("module"===c)a=y[v]=m.module(e);else if(h.hasOwnProperty(c)||g.hasOwnProperty(c)||b.hasOwnProperty(c))y[v]=l(c);else{if(!f.p)throw Error(e+" missing "+c);f.p.load(f.n,i(o,!0),s(c),{}),y[v]=h[c]}d=n.apply(h[e],y),e&&(a&&a.exports!==r&&a.exports!==h[e]?h[e]=a.exports:d===r&&w||(h[e]=d))}else e&&(h[e]=n);u(e,h,y)},e=t=v=function(e,t,n,o,i){return"string"==typeof e?m[e]?m[e](t):l(p(e,t).f):(e.splice||(w=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},"function"==typeof n&&(n=o,o=i),o?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},15),v)},v.config=function(e){return w=e,v},n=function(e,t,n){t.splice||(n=t,t=[]),g[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("durandal/amd/almond-custom",function(){}),n("main-built",function(){}),n("durandal/system",["require"],function(t){var n,r=!1,o=Object.keys,i=Object.prototype.hasOwnProperty,a=Object.prototype.toString,s=!1;if(Function.prototype.bind&&("object"==typeof console||"function"==typeof console)&&"object"==typeof console.log)try{["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]=this.call(console[e],console)},Function.prototype.bind)}catch(l){s=!0}t.on&&t.on("moduleLoaded",function(e,t){n.setModuleId(e,t)}),e!==void 0&&(e.onResourceLoad=function(e,t){n.setModuleId(e.defined[t.id],t.id)});var c=function(){},u=function(){try{if("undefined"!=typeof console&&"function"==typeof console.log)if(window.opera)for(var e=0;arguments.length>e;)console.log("Item "+(e+1)+": "+arguments[e]),e++;else 1==Array.prototype.slice.call(arguments).length&&"string"==typeof Array.prototype.slice.call(arguments)[0]?console.log(""+Array.prototype.slice.call(arguments)):console.log(Array.prototype.slice.call(arguments));else Function.prototype.bind&&!s||"undefined"==typeof console||"object"!=typeof console.log||Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments))}catch(t){}};return n={version:"1.2.0",noop:c,getModuleId:function(e){return e?"function"==typeof e?e.prototype.__moduleId__:"string"==typeof e?null:e.__moduleId__:null},setModuleId:function(e,t){return e?"function"==typeof e?(e.prototype.__moduleId__=t,void 0):("string"!=typeof e&&(e.__moduleId__=t),void 0):void 0},debug:function(e){return 1!=arguments.length?r:(r=e,r?(this.log=u,this.log("Debug mode enabled.")):(this.log("Debug mode disabled."),this.log=c),void 0)},isArray:function(e){return"[object Array]"===a.call(e)},log:c,defer:function(e){return $.Deferred(e)},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},acquire:function(){var e=Array.prototype.slice.call(arguments,0);return this.defer(function(n){t(e,function(){var e=arguments;setTimeout(function(){n.resolve.apply(n,e)},1)})}).promise()}},n.keys=o||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)i.call(e,n)&&(t[t.length]=n);return t},n}),n("durandal/viewEngine",["./system"],function(e){var t;return t=$.parseHTML?function(e){return $.parseHTML(e)}:function(e){return $(e).get()},{viewExtension:".html",viewPlugin:"text",isViewUrl:function(e){return-1!==e.indexOf(this.viewExtension,e.length-this.viewExtension.length)},convertViewUrlToViewId:function(e){return e.substring(0,e.length-this.viewExtension.length)},convertViewIdToRequirePath:function(e){return this.viewPlugin+"!"+e+this.viewExtension},parseMarkup:function(e){var n=t(e);if(1==n.length)return n[0];for(var r=[],o=0;n.length>o;o++){var i=n[o];if(8!=i.nodeType){if(3==i.nodeType){var a=/\S/.test(i.nodeValue);if(!a)continue}r.push(i)}}return r.length>1?$(r).wrapAll('<div class="durandal-wrapper"></div>').parent().get(0):r[0]},createView:function(t){var n=this,r=this.convertViewIdToRequirePath(t);return e.defer(function(o){e.acquire(r).then(function(e){var r=n.parseMarkup(e);r.setAttribute("data-view",t),o.resolve(r)})}).promise()}}}),n("durandal/viewLocator",["./system","./viewEngine"],function(e,t){function n(e,t){for(var n=0;e.length>n;n++){var r=e[n],o=r.getAttribute("data-view");if(o==t)return r}}function r(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}return{useConvention:function(e,t,n){e=e||"viewmodels",t=t||"views",n=n||t;var o=RegExp(r(e),"gi");this.convertModuleIdToViewId=function(e){return e.replace(o,t)},this.translateViewIdToArea=function(e,t){return t&&"partial"!=t?n+"/"+t+"/"+e:n+"/"+e}},locateViewForObject:function(t,n){var r;if(t.getView&&(r=t.getView()))return this.locateView(r,null,n);if(t.viewUrl)return this.locateView(t.viewUrl,null,n);var o=e.getModuleId(t);return o?this.locateView(this.convertModuleIdToViewId(o),null,n):this.locateView(this.determineFallbackViewId(t),null,n)},convertModuleIdToViewId:function(e){return e},determineFallbackViewId:function(e){var t=/function (.{1,})\(/,n=t.exec(""+e.constructor),r=n&&n.length>1?n[1]:"";return"views/"+r},translateViewIdToArea:function(e){return e},locateView:function(r,o,i){if("string"==typeof r){var a;if(a=t.isViewUrl(r)?t.convertViewUrlToViewId(r):r,o&&(a=this.translateViewIdToArea(a,o)),i){var s=n(i,a);if(s)return e.defer(function(e){e.resolve(s)}).promise()}return t.createView(a)}return e.defer(function(e){e.resolve(r)}).promise()}}}),n("durandal/viewModelBinder",["./system"],function(e){function t(t,i,a){if(!i||!t){if(n.throwOnErrors)throw Error(r);return e.log(r,i,t),void 0}if(!i.getAttribute){if(n.throwOnErrors)throw Error(o);return e.log(o,i,t),void 0}var s=i.getAttribute("data-view");try{e.log("Binding",s,t),n.beforeBind(t,i),a(),n.afterBind(t,i)}catch(l){if(n.throwOnErrors)throw Error(l.message+";\nView: "+s+";\nModuleId: "+e.getModuleId(t));e.log(l.message,s,t)}}var n,r="Insufficient Information to Bind",o="Unexpected View Type";return n={beforeBind:e.noop,afterBind:e.noop,bindContext:function(e,n,r){r&&(e=e.createChildContext(r)),t(e,n,function(){r&&r.beforeBind&&r.beforeBind(n),ko.applyBindings(e,n),r&&r.afterBind&&r.afterBind(n)})},bind:function(e,n){t(e,n,function(){e.beforeBind&&e.beforeBind(n),ko.applyBindings(e,n),e.afterBind&&e.afterBind(n)})}}}),n("durandal/viewModel",["./system"],function(e){function t(e){return void 0==e&&(e={}),e.closeOnDeactivate||(e.closeOnDeactivate=s.defaults.closeOnDeactivate),e.beforeActivate||(e.beforeActivate=s.defaults.beforeActivate),e.afterDeactivate||(e.afterDeactivate=s.defaults.afterDeactivate),e.interpretResponse||(e.interpretResponse=s.defaults.interpretResponse),e.areSameItem||(e.areSameItem=s.defaults.areSameItem),e}function n(t,n,r,o,i){if(t&&t.deactivate){e.log("Deactivating",t);var a;try{a=t.deactivate(n)}catch(s){return e.log(s),o.resolve(!1),void 0}a&&a.then?a.then(function(){r.afterDeactivate(t,n,i),o.resolve(!0)},function(t){e.log(t),o.resolve(!1)}):(r.afterDeactivate(t,n,i),o.resolve(!0))}else t&&r.afterDeactivate(t,n,i),o.resolve(!0)}function r(t,n,r,o){if(t)if(t.activate){e.log("Activating",t);var i;try{i=t.activate(o)}catch(a){return e.log(a),r(!1),void 0}i&&i.then?i.then(function(){n(t),r(!0)},function(t){e.log(t),r(!1)}):(n(t),r(!0))}else n(t),r(!0);else r(!0)}function o(t,n,r){return e.defer(function(o){if(t&&t.canDeactivate){var i;try{i=t.canDeactivate(n)}catch(a){return e.log(a),o.resolve(!1),void 0}i.then?i.then(function(e){o.resolve(r.interpretResponse(e))},function(t){e.log(t),o.resolve(!1)}):o.resolve(r.interpretResponse(i))}else o.resolve(!0)}).promise()}function i(t,n,r,o){return e.defer(function(i){if(t==n())return i.resolve(!0),void 0;if(t&&t.canActivate){var a;try{a=t.canActivate(o)}catch(s){return e.log(s),i.resolve(!1),void 0}a.then?a.then(function(e){i.resolve(r.interpretResponse(e))},function(t){e.log(t),i.resolve(!1)}):i.resolve(r.interpretResponse(a))}else i.resolve(!0)}).promise()}function a(a,s){var l=ko.observable(null);s=t(s);var c=ko.computed({read:function(){return l()},write:function(e){c.viaSetter=!0,c.activateItem(e)}});return c.settings=s,s.activator=c,c.isActivating=ko.observable(!1),c.canDeactivateItem=function(e,t){return o(e,t,s)},c.deactivateItem=function(t,r){return e.defer(function(e){c.canDeactivateItem(t,r).then(function(o){o?n(t,r,s,e,l):(c.notifySubscribers(),e.resolve(!1))})}).promise()},c.canActivateItem=function(e,t){return i(e,l,s,t)},c.activateItem=function(t,o){var i=c.viaSetter;return c.viaSetter=!1,e.defer(function(a){if(c.isActivating())return a.resolve(!1),void 0;c.isActivating(!0);var u=l();return s.areSameItem(u,t,o)?(c.isActivating(!1),a.resolve(!0),void 0):(c.canDeactivateItem(u,s.closeOnDeactivate).then(function(d){d?c.canActivateItem(t,o).then(function(d){d?e.defer(function(e){n(u,s.closeOnDeactivate,s,e)}).promise().then(function(){t=s.beforeActivate(t,o),r(t,l,function(e){c.isActivating(!1),a.resolve(e)},o)}):(i&&c.notifySubscribers(),c.isActivating(!1),a.resolve(!1))}):(i&&c.notifySubscribers(),c.isActivating(!1),a.resolve(!1))}),void 0)}).promise()},c.canActivate=function(){var e;return a?(e=a,a=!1):e=c(),c.canActivateItem(e)},c.activate=function(){var e;return a?(e=a,a=!1):e=c(),c.activateItem(e)},c.canDeactivate=function(e){return c.canDeactivateItem(c(),e)},c.deactivate=function(e){return c.deactivateItem(c(),e)},c.includeIn=function(e){e.canActivate=function(){return c.canActivate()},e.activate=function(){return c.activate()},e.canDeactivate=function(e){return c.canDeactivate(e)},e.deactivate=function(e){return c.deactivate(e)}},s.includeIn?c.includeIn(s.includeIn):a&&c.activate(),c.forItems=function(t){s.closeOnDeactivate=!1,s.determineNextItemToActivate=function(e,t){var n=t-1;return-1==n&&e.length>1?e[1]:n>-1&&e.length-1>n?e[n]:null},s.beforeActivate=function(e){var n=c();if(e){var r=t.indexOf(e);-1==r?t.push(e):e=t()[r]}else e=s.determineNextItemToActivate(t,n?t.indexOf(n):0);return e},s.afterDeactivate=function(e,n){n&&t.remove(e)};var n=c.canDeactivate;c.canDeactivate=function(r){return r?e.defer(function(e){function n(){for(var t=0;i.length>t;t++)if(!i[t])return e.resolve(!1),void 0;e.resolve(!0)}for(var o=t(),i=[],a=0;o.length>a;a++)c.canDeactivateItem(o[a],r).then(function(e){i.push(e),i.length==o.length&&n()})}).promise():n()};var r=c.deactivate;return c.deactivate=function(n){return n?e.defer(function(e){function r(r){c.deactivateItem(r,n).then(function(){i++,t.remove(r),i==a&&e.resolve()})}for(var o=t(),i=0,a=o.length,s=0;a>s;s++)r(o[s])}).promise():r()},c},c}var s;return s={defaults:{closeOnDeactivate:!0,interpretResponse:function(e){if("string"==typeof e){var t=e.toLowerCase();return"yes"==t||"ok"==t}return e},areSameItem:function(e,t){return e==t},beforeActivate:function(e){return e},afterDeactivate:function(e,t,n){t&&n&&n(null)}},activator:a}}),n("durandal/composition",["./viewLocator","./viewModelBinder","./viewEngine","./system","./viewModel"],function(e,t,n,r,o){function i(e){return e.model&&e.model.activate&&(f.activateDuringComposition&&void 0==e.activate||e.activate)}function a(e,t){i(e)?o.activator().activateItem(e.model).then(function(e){e&&t()}):t()}function s(e){for(var t=[],n={childElements:t,activeView:null},r=ko.virtualElements.firstChild(e);r;)1==r.nodeType&&(t.push(r),r.getAttribute(d)&&(n.activeView=r)),r=ko.virtualElements.nextSibling(r);return n}function l(e,t,n){n.activeView&&n.activeView.removeAttribute(d),t&&(n.model&&n.model.viewAttached&&(n.composingNewView||n.alwaysAttachView)&&n.model.viewAttached(t),t.setAttribute(d,!0)),n.afterCompose&&n.afterCompose(e,t,n)}function c(e,t){if("string"==typeof t.transition){if(t.activeView){if(t.activeView==e)return!1;if(!e)return!0;if(t.skipTransitionOnSameViewId){var n=t.activeView.getAttribute("data-view"),r=e.getAttribute("data-view");return n!=r}}return!0}return!1}var u={},d="data-active-view",f={activateDuringComposition:!1,convertTransitionToModuleId:function(e){return"durandal/transitions/"+e},switchContent:function(e,t,n){if(n.transition=n.transition||this.defaultTransitionName,c(t,n)){var o=this.convertTransitionToModuleId(n.transition);r.acquire(o).then(function(r){n.transition=r,r(e,t,n).then(function(){l(e,t,n)})})}else t!=n.activeView&&(n.cacheViews&&n.activeView&&$(n.activeView).css("display","none"),t?n.cacheViews?n.composingNewView?(n.viewElements.push(t),ko.virtualElements.prepend(e,t)):$(t).css("display",""):(ko.virtualElements.emptyNode(e),ko.virtualElements.prepend(e,t)):n.cacheViews||ko.virtualElements.emptyNode(e)),l(e,t,n)},bindAndShow:function(e,r,o){o.composingNewView=o.cacheViews?-1==ko.utils.arrayIndexOf(o.viewElements,r):!0,a(o,function(){if(o.beforeBind&&o.beforeBind(e,r,o),o.preserveContext&&o.bindingContext)o.composingNewView&&t.bindContext(o.bindingContext,r,o.model);else if(r){var i=o.model||u,a=ko.dataFor(r);if(a!=i){if(!o.composingNewView)return $(r).remove(),n.createView(r.getAttribute("data-view")).then(function(t){f.bindAndShow(e,t,o)}),void 0;t.bind(i,r)}}f.switchContent(e,r,o)})},defaultStrategy:function(t){return e.locateViewForObject(t.model,t.viewElements)},getSettings:function(e){var t=ko.utils.unwrapObservable(e())||{};if("string"==typeof t)return t;var n=r.getModuleId(t);if(n)return{model:t};for(var o in t)t[o]=ko.utils.unwrapObservable(t[o]);return t},executeStrategy:function(e,t){t.strategy(t).then(function(n){f.bindAndShow(e,n,t)})},inject:function(t,n){return n.model?n.view?(e.locateView(n.view,n.area,n.viewElements).then(function(e){f.bindAndShow(t,e,n)}),void 0):((void 0===n.view||n.view)&&(n.strategy||(n.strategy=this.defaultStrategy),"string"==typeof n.strategy?r.acquire(n.strategy).then(function(e){n.strategy=e,f.executeStrategy(t,n)}):this.executeStrategy(t,n)),void 0):(this.bindAndShow(t,null,n),void 0)},compose:function(t,o,i){"string"==typeof o&&(o=n.isViewUrl(o)?{view:o}:{model:o});var a=r.getModuleId(o);a&&(o={model:o});var l=s(t);o.bindingContext=i,o.activeView=l.activeView,o.cacheViews&&!o.viewElements&&(o.viewElements=l.childElements),o.model?"string"==typeof o.model?r.acquire(o.model).then(function(e){o.model="function"==typeof e?new e(t,o):e,f.inject(t,o)}):f.inject(t,o):o.view?(o.area=o.area||"partial",o.preserveContext=!0,e.locateView(o.view,o.area,o.viewElements).then(function(e){f.bindAndShow(t,e,o)})):this.bindAndShow(t,null,o)}};return ko.bindingHandlers.compose={update:function(e,t,n,r,o){var i=f.getSettings(t);f.compose(e,i,o)}},ko.virtualElements.allowedBindings.compose=!0,f}),n("durandal/widget",["./system","./composition"],function(e,t){var n="data-part",r="["+n+"]",o={},i={},a=["model","view","kind"],s={getParts:function(t){var o={};e.isArray(t)||(t=[t]);for(var i=0;t.length>i;i++){var a=t[i];if(a.getAttribute){var s=a.getAttribute(n);s&&(o[s]=a);for(var l=$(r,a),c=0;l.length>c;c++){var u=l.get(c);o[u.getAttribute(n)]=u}}}return o},getSettings:function(e){var t=ko.utils.unwrapObservable(e())||{};if("string"==typeof t)return t;for(var n in t)t[n]=-1!=ko.utils.arrayIndexOf(a,n)?ko.utils.unwrapObservable(t[n]):t[n];return t},registerKind:function(e){ko.bindingHandlers[e]={init:function(){return{controlsDescendantBindings:!0}},update:function(t,n,r,o,i){var a=s.getSettings(n);a.kind=e,s.create(t,a,i)}},ko.virtualElements.allowedBindings[e]=!0},mapKind:function(e,t,n){t&&(i[e]=t),n&&(o[e]=n)},convertKindToModuleId:function(e){return o[e]||"durandal/widgets/"+e+"/controller"},convertKindToViewId:function(e){return i[e]||"durandal/widgets/"+e+"/view"},beforeBind:function(e,t){var n=s.getParts(e),r=s.getParts(t);for(var o in n)$(r[o]).replaceWith(n[o])},createCompositionSettings:function(e){return e.model||(e.model=this.convertKindToModuleId(e.kind)),e.view||(e.view=this.convertKindToViewId(e.kind)),e.preserveContext=!0,e.beforeBind=this.beforeBind,e},create:function(e,n,r){"string"==typeof n&&(n={kind:n});var o=s.createCompositionSettings(n);t.compose(e,o,r)}};return ko.bindingHandlers.widget={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,n,r,o){var i=s.getSettings(t);s.create(e,i,o)}},ko.virtualElements.allowedBindings.widget=!0,s}),n("durandal/modalDialog",["./composition","./system","./viewModel"],function(e,t,n){function r(e){return t.defer(function(n){"string"==typeof e?t.acquire(e).then(function(e){"function"==typeof e?n.resolve(new e):n.resolve(e)}):n.resolve(e)}).promise()}var o={},i=0,a={currentZIndex:1050,getNextZIndex:function(){return++this.currentZIndex},isModalOpen:function(){return i>0},getContext:function(e){return o[e||"default"]},addContext:function(e,t){t.name=e,o[e]=t;var n="show"+e.substr(0,1).toUpperCase()+e.substr(1);this[n]=function(t,n){return this.show(t,n,e)}},createCompositionSettings:function(e,t){var n={model:e,activate:!1};return t.afterCompose&&(n.afterCompose=t.afterCompose),n},show:function(a,s,l){var c=this,u=o[l||"default"];return t.defer(function(t){r(a).then(function(r){var o=n.activator();o.activateItem(r,s).then(function(n){if(n){var a=r.modal={owner:r,context:u,activator:o,close:function(){var e=arguments;o.deactivateItem(r,!0).then(function(n){n&&(i--,u.removeHost(a),delete r.modal,t.resolve.apply(t,e))})}};a.settings=c.createCompositionSettings(r,u),u.addHost(a),i++,e.compose(a.host,a.settings)}else t.resolve(!1)})})}).promise()}};return a.addContext("default",{blockoutOpacity:.2,removeDelay:200,addHost:function(e){var t=$("body"),n=$('<div class="modalBlockout"></div>').css({"z-index":a.getNextZIndex(),opacity:this.blockoutOpacity}).appendTo(t),r=$('<div class="modalHost"></div>').css({"z-index":a.getNextZIndex()}).appendTo(t);if(e.host=r.get(0),e.blockout=n.get(0),!a.isModalOpen()){e.oldBodyMarginRight=$("body").css("margin-right");var o=$("html"),i=t.outerWidth(!0),s=o.scrollTop();$("html").css("overflow-y","hidden");var l=$("body").outerWidth(!0);t.css("margin-right",l-i+parseInt(e.oldBodyMarginRight)+"px"),o.scrollTop(s),$("#simplemodal-overlay").css("width",l+"px")}},removeHost:function(e){if($(e.host).css("opacity",0),$(e.blockout).css("opacity",0),setTimeout(function(){$(e.host).remove(),$(e.blockout).remove()},this.removeDelay),!a.isModalOpen()){var t=$("html"),n=t.scrollTop();t.css("overflow-y","").scrollTop(n),$("body").css("margin-right",e.oldBodyMarginRight)}},afterCompose:function(e,t,n){var r=$(t),o=r.width(),i=r.height();r.css({"margin-top":""+-i/2+"px","margin-left":""+-o/2+"px"}),$(n.model.modal.host).css("opacity",1),$(t).hasClass("autoclose")&&$(n.model.modal.blockout).click(function(){n.model.modal.close()}),$(".autofocus",t).each(function(){$(this).focus()})}}),a}),n("durandal/events",["./system"],function(e){var t=/\s+/,n=function(){},r=function(e,t){this.owner=e,this.events=t};return r.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},r.prototype.on=r.prototype.then,r.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},n.prototype.on=function(e,n,o){var i,a,s;if(n){for(i=this.callbacks||(this.callbacks={}),e=e.split(t);a=e.shift();)s=i[a]||(i[a]=[]),s.push(n,o);return this}return new r(this,e)},n.prototype.off=function(n,r,o){var i,a,s,l;if(!(a=this.callbacks))return this;if(!(n||r||o))return delete this.callbacks,this;for(n=n?n.split(t):e.keys(a);i=n.shift();)if((s=a[i])&&(r||o))for(l=s.length-2;l>=0;l-=2)r&&s[l]!==r||o&&s[l+1]!==o||s.splice(l,2);else delete a[i];return this},n.prototype.trigger=function(e){var n,r,o,i,a,s,l,c;if(!(r=this.callbacks))return this;for(c=[],e=e.split(t),i=1,a=arguments.length;a>i;i++)c[i-1]=arguments[i];for(;n=e.shift();){if((l=r.all)&&(l=l.slice()),(o=r[n])&&(o=o.slice()),o)for(i=0,a=o.length;a>i;i+=2)o[i].apply(o[i+1]||this,c);if(l)for(s=[n].concat(c),i=0,a=l.length;a>i;i+=2)l[i].apply(l[i+1]||this,s)}return this},n.prototype.proxy=function(e){var t=this;return function(n){t.trigger(e,n)}},n.includeIn=function(e){e.on=n.prototype.on,e.off=n.prototype.off,e.trigger=n.prototype.trigger,e.proxy=n.prototype.proxy},n}),n("durandal/app",["./system","./viewEngine","./composition","./widget","./modalDialog","./events"],function(e,t,n,r,o,i){var a={title:"Application",showModal:function(e,t,n){return o.show(e,t,n)},showMessage:function(e,t,n){return o.show("./messageBox",{message:e,title:t||this.title,options:n})},start:function(){var t=this;return t.title&&(document.title=t.title),e.defer(function(t){$(function(){e.log("Starting Application"),t.resolve(),e.log("Started Application")})}).promise()},setRoot:function(e,r,o){var i,a={activate:!0,transition:r};i=o&&"string"!=typeof o?o:document.getElementById(o||"applicationHost"),"string"==typeof e?t.isViewUrl(e)?a.view=e:a.model=e:a.model=e,n.compose(i,a)},adaptToDevice:function(){document.ontouchmove=function(e){e.preventDefault()}}};return i.includeIn(a),a}),n("durandal/plugins/router",["../system","../viewModel","../app"],function(e,t,n){function r(t){T(!1),e.log("Redirecting"),g.navigateTo(t)}function o(){R=!0,e.log("Cancelling Navigation"),w&&h.setLocation(w),R=!1,T(!1);var t=h.last_location[1].split("#/")[1];w||!t?C():t!=y?window.location.replace("#/"+y):C()}function i(e,t,n){N(e),g.onNavigationComplete(e,t,n),b=n,w=h.last_location[1].replace("/",""),C()}function a(t,n,r){e.log("Activating Route",t,r,n),P.activateItem(r,n).then(function(e){e?i(t,n,r):o()})}function s(){return R||h.last_location[1].replace("/","")==w}function l(e,t,n){var i=g.guardRoute(e,t,n);i?i.then?i.then(function(i){i?"string"==typeof i?r(i):a(e,t,n):o()}):"string"==typeof i?r(i):a(e,t,n):o()}function c(){if(!T()){var t=V.shift();V=[],t&&(T(!0),e.acquire(t.routeInfo.moduleId).then(function(e){t.params.routeInfo=t.routeInfo,t.params.router=g;var n=g.getActivatableInstance(t.routeInfo,t.params,e);g.guardRoute?l(t.routeInfo,t.params,n):a(t.routeInfo,t.params,n)}))}}function u(e,t){V.unshift({routeInfo:e,params:t}),c()}function d(e,t){var n=I[e];if(!s()){if(!n){if(!g.autoConvertRouteToModuleId)return g.handleInvalidRoute(e,t),void 0;n={moduleId:g.autoConvertRouteToModuleId(e,t),name:g.convertRouteToName(e)}}u(n,t)}}function f(){d(y,this.params||{})}function v(){d(""+this.app.last_route.path,this.params||{})}function p(){var e,t=this.params||{};if(g.autoConvertRouteToModuleId){var n=this.path.split("#/");if(2==n.length){var r=n[1].split("/");return e=r[0],t.splat=r.splice(1),d(e,t),void 0}}g.handleInvalidRoute(this.app.last_location[1],t)}function m(e){return g.prepareRouteInfo(e),I[""+e.url]=e,k.push(e),e.visible&&(e.isActive=ko.computed(function(){return E()&&P()&&P().__moduleId__==e.moduleId}),A.push(e)),e}var h,g,w,b,y,x,I={},k=ko.observableArray([]),A=ko.observableArray([]),E=ko.observable(!1),T=ko.observable(!1),R=!1,P=t.activator(),N=ko.observable(),V=[],C=function(){C=e.noop,E(!0),g.dfd.resolve(),delete g.dfd};return P.settings.areSameItem=function(){return!1},g={ready:E,allRoutes:k,visibleRoutes:A,isNavigating:T,activeItem:P,activeRoute:N,afterCompose:function(){setTimeout(function(){T(!1),c()},10)},getActivatableInstance:function(e,t,n){return"function"==typeof n?new n:n},useConvention:function(e){e=null==e?"viewmodels":e,e&&(e+="/"),g.convertRouteToModuleId=function(t){return e+g.stripParameter(t)}},stripParameter:function(e){var t=e.indexOf(":"),n=t>0?t-1:e.length;return e.substring(0,n)},handleInvalidRoute:function(t,n){e.log("No Route Found",t,n)},onNavigationComplete:function(e){document.title=n.title?e.caption+" | "+n.title:e.caption},navigateBack:function(){window.history.back()},navigateTo:function(e,t){switch(t=t||"trigger",t.toLowerCase()){case"skip":x=e,h.setLocation(e);break;case"replace":window.location.replace(e);break;default:h.lookupRoute("get",e)?h.setLocation(e):window.location.href=e}},replaceLocation:function(e){this.navigateTo(e,"replace")},convertRouteToName:function(e){var t=g.stripParameter(e);return t.substring(0,1).toUpperCase()+t.substring(1)},convertRouteToModuleId:function(e){return g.stripParameter(e)},prepareRouteInfo:function(e){e.url instanceof RegExp||(e.name=e.name||g.convertRouteToName(e.url),e.moduleId=e.moduleId||g.convertRouteToModuleId(e.url),e.hash=e.hash||"#/"+e.url),e.caption=e.caption||e.name,e.settings=e.settings||{}},mapAuto:function(e){e=e||"viewmodels",e+="/",g.autoConvertRouteToModuleId=function(t){return e+g.stripParameter(t)}},mapNav:function(e,t,n){return"string"==typeof e?this.mapRoute(e,t,n,!0):(e.visible=!0,m(e))},mapRoute:function(e,t,n,r){return"string"==typeof e?m({url:e,moduleId:t,name:n,visible:r}):m(e)},map:function(t){if(!e.isArray(t))return m(t);for(var n=[],r=0;t.length>r;r++)n.push(m(t[r]));return n},activate:function(t){return e.defer(function(n){var r;g.dfd=n,y=t,h=Sammy(function(e){for(var t=k(),n=0;t.length>n;n++){var o=t[n];e.get(o.url,v),r=this.routes.get[n],I[""+r.path]=o}e.get("#/",f),e.get(/\#\/(.*)/,p)}),h._checkFormSubmission=function(){return!1},h.before(null,function(e){if(x){if(e.path==="/"+x)return x=null,!1;throw Error("Expected to skip url '"+x+"', but found url '"+e.path+"'")}return!0}),h.log=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("Sammy"),e.log.apply(e,t)},h.run("#/")}).promise()}}}),n("services/appsecurity",["require","durandal/system","durandal/app","durandal/plugins/router"],function(e){var t=(e("durandal/system"),e("durandal/app"),e("durandal/plugins/router")),n="api/account",r=function(e,t,n){this.userName=e,this.password=t,this.rememberMe=n},o=ko.observable({IsAuthenticated:!1,UserName:"",Roles:[],AntiforgeryToken:null}),i=ko.observable(),a=function(){$.get(n+"/getantiforgerytokens").then(function(e){o().AntiforgeryToken=e,$(document).ajaxSend(function(t,n,r){r.hasContent&&n.setRequestHeader("__RequestVerificationToken",e)})})};return{credential:r,user:o,externalLogins:i,isUserInRole:function(e){var t=this,n=!1;return $.each(e,function(e,r){-1!=t.user().Roles.indexOf(r)&&(n=!0)}),n},login:function(e,r){var o=this,i=$.post(n+"/login",e).done(function(e){o.user(e),o.addAntiForgeryTokenToAjaxRequests(),1==e.IsAuthenticated&&(r?t.navigateTo(r):t.navigateTo("/#/account"))}).fail(function(){o.user({IsAuthenticated:!1,UserName:"",Roles:[]})});return i},logout:function(){var e=this,o=$.post(n+"/logout",r).done(function(n){e.user(n),e.addAntiForgeryTokenToAjaxRequests(),null!=t.activeRoute().settings.authorize&&t.navigateTo("/#/home")}).fail(function(e){return e});return o},register:function(e,r,o,i){var a=this,s=$.post(n+"/register",{username:e,email:r,password:o,confirmpassword:i}).done(function(e){a.user(e),a.addAntiForgeryTokenToAjaxRequests(),t.navigateTo("/#/account")});return s},getAuthInfo:function(){var e=$.get(n+"/userinfo");return e},getExternalLogins:function(){var e=$.get(n+"/externalloginslist");return e},addAntiForgeryTokenToAjaxRequests:a,externalLogin:function(e,t){var r=location.href=n+"/externallogin?provider="+e+"&returnurl="+t;return r},getExternalLoginConfirmationData:function(e,t,r,o){var i=$.get(n+"/externalloginconfirmation?returnurl="+e+"&username="+t+"&provideruserid="+r+"&provider="+o);return i},confirmExternalAccount:function(e,t,r,o){var i=this,a=$.post(n+"/registerexternallogin",{displayname:e,username:t,email:r,externallogindata:o}).done(function(e){i.user(e),i.addAntiForgeryTokenToAjaxRequests()});return a},hasLocalAccount:function(){var e=$.get(n+"/haslocalaccount");return e},changePassword:function(e,t,r){var o=$.post(n+"/changepassword",{oldpassword:e,newpassword:t,confirmpassword:r});return o},createLocalAccount:function(e,t){var r=$.post(n+"/createlocalaccount",{newpassword:e,confirmpassword:t});return r}}}),e.config({paths:{text:"durandal/amd/text"}}),n("main",["durandal/app","durandal/viewLocator","durandal/system","durandal/plugins/router","services/appsecurity"],function(e,t,n,r,o){e.title="Durandal Starter Kit",e.start().then(function(){t.useConvention(),r.useConvention(),r.map([{url:"home",moduleId:"viewmodels/home/home",name:"Home",visible:!0},{url:"login",moduleId:"viewmodels/account/login",name:"Login",visible:!1},{url:"admin",moduleId:"viewmodels/admin/admin",name:"Admin",settings:{authorize:["Administrator"]},visible:!0},{url:"user",moduleId:"viewmodels/user/user",name:"User",settings:{authorize:["User"]},visible:!0},{url:"externalloginconfirmation",moduleId:"viewmodels/account/externalloginconfirmation",name:"External login confirmation",visible:!1},{url:"externalloginfailure",moduleId:"viewmodels/account/externalloginfailure",name:"External login failure",visible:!1},{url:"register",moduleId:"viewmodels/account/register",name:"Register",visible:!1},{url:"account",moduleId:"viewmodels/account/account",name:"Account",visible:!1,settings:{authorize:["User"]}}]),o.addAntiForgeryTokenToAjaxRequests(),r.guardRoute=function(e){return e.settings.authorize?o.user().IsAuthenticated&&o.isUserInRole(e.settings.authorize)?!0:"/#/login?redirectto="+e.url:!0},o.getAuthInfo().then(function(e){o.user(e)}),ko.validation.init({decorateElement:!0,errorElementClass:"error",registerExtenders:!0,messagesOnModified:!0,insertMessages:!0,parseInputAttributes:!0,messageTemplate:null}),e.setRoot("viewmodels/shell","entrance")})}),n("durandal/http",[],function(){return{defaultJSONPCallbackParam:"callback",get:function(e,t){return $.ajax(e,{data:t})},jsonp:function(e,t,n){return-1==e.indexOf("=?")&&(n=n||this.defaultJSONPCallbackParam,e+=-1==e.indexOf("?")?"?":"&",e+=n+"=?"),$.ajax({url:e,dataType:"jsonp",data:t})},post:function(e,t){return $.ajax({url:e,data:ko.toJSON(t),type:"POST",contentType:"application/json",dataType:"json"})}}}),n("text",["module"],function(e){var n,r,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,l=s&&location.protocol&&location.protocol.replace(/\:/,""),c=s&&location.hostname,u=s&&(location.port||void 0),d=[],f=e.config&&e.config()||{};return n={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=o[t];
try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),o=e.substring(n+1,e.length);return n=o.indexOf("!"),-1!==n&&(t=o.substring(n+1,o.length),t="strip"===t,o=o.substring(0,n)),{moduleName:r,ext:o,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,o){var i,a,s,l=n.xdRegExp.exec(e);return l?(i=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(i&&i!==t||a&&a.toLowerCase()!==r.toLowerCase()||(s||a)&&s!==o)):!0},finishLoad:function(e,t,r,o){r=t?n.strip(r):r,f.isBuild&&(d[e]=r),o(r)},load:function(e,t,r,o){if(o.isBuild&&!o.inlineText)return r(),void 0;f.isBuild=o.isBuild;var i=n.parseName(e),a=i.moduleName+"."+i.ext,d=t.toUrl(a),v=f.useXhr||n.useXhr;!s||v(d,l,c,u)?n.get(d,function(t){n.finishLoad(e,i.strip,t,r)},function(e){r.error&&r.error(e)}):t([a],function(e){n.finishLoad(i.moduleName+"."+i.ext,i.strip,e,r)})},write:function(e,t,r){if(d.hasOwnProperty(t)){var o=n.jsEscape(d[t]);r.asModule(e+"!"+t,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,t,r,o,i){var a=n.parseName(t),s=a.moduleName+"."+a.ext,l=r.toUrl(a.moduleName+"."+a.ext)+".js";n.load(s,r,function(){var t=function(e){return o(l,e)};t.asModule=function(e,t){return o.asModule(e,l,t)},n.write(e,s,t,i)},i)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(r=t.nodeRequire("fs"),n.get=function(e,t){var n=r.readFileSync(e,"utf8");0===n.indexOf("ï»¿")&&(n=n.substring(1)),t(n)}):"xhr"===f.env||!f.env&&n.createXhr()?n.get=function(e,t,r){var o=n.createXhr();o.open("GET",e,!0),f.onXhr&&f.onXhr(o,e),o.onreadystatechange=function(){var n,i;4===o.readyState&&(n=o.status,n>399&&600>n?(i=Error(e+" HTTP status: "+n),i.xhr=o,r(i)):t(o.responseText))},o.send(null)}:("rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(n.get=function(e,t){var n,r,o="utf-8",i=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),o)),l="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=s.readLine());)n.append(a),n.append(r);l=""+n+""}finally{s.close()}t(l)}),n}),n("text!durandal/messageBox.html",[],function(){return'<div class="messageBox">\r\n    <div class="modal-header">\r\n        <h3 data-bind="html: title"></h3>\r\n    </div>\r\n    <div class="modal-body">\r\n        <p class="message" data-bind="html: message"></p>\r\n    </div>\r\n    <div class="modal-footer" data-bind="foreach: options">\r\n        <button class="btn" data-bind="click: function () { $parent.selectOption($data); }, html: $data, css: { \'btn-primary\': $index() == 0, autofocus: $index() == 0 }"></button>\r\n    </div>\r\n</div>'}),n("durandal/messageBox",[],function(){var e=function(t,n,r){this.message=t,this.title=n||e.defaultTitle,this.options=r||e.defaultOptions};return e.prototype.selectOption=function(e){this.modal.close(e)},e.prototype.activate=function(t){t&&(this.message=t.message,this.title=t.title||e.defaultTitle,this.options=t.options||e.defaultOptions)},e.defaultTitle="Application",e.defaultOptions=["Ok"],e}),n("durandal/transitions/entrance",["../system"],function(e){var t=100,n=function(n,r,o){return e.defer(function(e){function i(){e.resolve()}function a(){o.keepScrollPosition||$(document).scrollTop(0)}function s(){a(),o.cacheViews?o.composingNewView&&ko.virtualElements.prepend(n,r):(ko.virtualElements.emptyNode(n),ko.virtualElements.prepend(n,r));var e={marginLeft:"20px",marginRight:"-20px",opacity:0,display:"block"},t={marginRight:0,marginLeft:0,opacity:1};$(r).css(e),$(r).animate(t,c,"swing",i)}if(r){var l=$(o.activeView),c=o.duration||500;l.length?l.fadeOut(t,s):s()}else a(),o.activeView?$(o.activeView).fadeOut(t,function(){o.cacheViews||ko.virtualElements.emptyNode(n),i()}):(o.cacheViews||ko.virtualElements.emptyNode(n),i())}).promise()};return n}),n("services/logger",["durandal/system"],function(e){function t(e,t,n,r){o(e,t,n,r,"info")}function n(e,t,n,r){o(e,t,n,r,"error")}function r(e,t,n,r){o(e,t,n,r,"success")}function o(t,n,r,o,i){r=r?"["+r+"] ":"",n?e.log(r,t,n):e.log(r,t),o&&("error"===i?toastr.error(t,"Something failed",{timeOut:0,positionClass:"toast-bottom-full-width"}):"success"===i?toastr.success(t,"Success",{timeOut:0,positionClass:"toast-bottom-full-width"}):toastr.info(t,"Info",{timeOut:0,positionClass:"toast-bottom-full-width"}))}var i={log:t,logError:n,logSuccess:r};return i}),n("services/utils",[],function(){function e(e){return decodeURI((RegExp(e+"="+"(.+?)(&|$)").exec(location.href)||[,null])[1])}function t(){return new Date}function n(e){try{var t=e.entitiesWithErrors[0];return"Validation Error: "+r(t)}catch(n){return"Save validation error"}}function r(e){try{var t=e.entityAspect.getValidationErrors(),n=t.map(function(e){return e.errorMessage});return n.length?n.join("; "):"no validation errors"}catch(r){return"not an entity"}}return{getCurrentDate:t,getSaveValidationErrorMessage:n,getEntityValidationErrorMessage:r,getURLParameter:e}}),n("services/errorhandler",["services/logger","durandal/system","services/utils"],function(e,t,n){function r(e){return $.extend(e,new o(e))}var o=function(){var r=function(r){this.handleError=function(o){throw o.message.match(/validation error/i)&&(o.message=n.getSaveValidationErrorMessage(o)),e.logError(o.message,null,t.getModuleId(r),!0),o},this.log=function(n,o){e.log(n,null,t.getModuleId(r),o)},this.handlevalidationerrors=function(t){""!=t.responseText?$.each($.parseJSON(t.responseText),function(n,r){e.logError(r,null,t,!0)}):e.logError(t.statusText,null,t,!0)}};return r}();return{includeIn:r}}),n("viewmodels/shell",["durandal/plugins/router","durandal/app","services/appsecurity","services/errorhandler"],function(e,t,n,r){var o={router:e,appsecurity:n,logout:function(){var e=this;n.logout().fail(e.handlevalidationerrors)},activate:function(){return e.activate("home")}};return r.includeIn(o),o}),n("viewmodels/account/account",["services/appsecurity","services/errorhandler","services/logger"],function(e,t,n){var r=ko.observable(),o=ko.observable().extend({required:!0,minLength:6}),i=ko.observable().extend({required:!0,minLength:6}),a=ko.observable().extend({required:!0,minLength:6,equal:o}),s={hasAccount:r,newPassword:o,oldPassword:i,confirmNewPassword:a,changePassword:function(){var t=this;return 0!=this.errors().length?(this.errors.showAllMessages(),void 0):(e.changePassword(this.oldPassword(),this.newPassword(),this.confirmNewPassword()).then(function(){e.hasLocalAccount().then(function(e){t.hasAccount(e),n.logSuccess("Password changed succesfully",null,null,!0,"success")})}).fail(t.handlevalidationerrors),void 0)},createLocalAccount:function(){var t=this;return 0!=this.errors().length?(this.errors.showAllMessages(),void 0):(e.createLocalAccount(this.newPassword(),this.confirmNewPassword()).then(function(){e.hasLocalAccount().then(function(e){t.hasAccount(e),t.oldPassword(""),t.confirmNewPassword("")})}).fail(t.handlevalidationerrors),void 0)},activate:function(){var t=this;return e.hasLocalAccount().then(function(e){t.hasAccount(e)}).fail(t.handlevalidationerrors)}};return t.includeIn(s),s.errors=ko.validation.group(s),s}),n("viewmodels/account/externalloginconfirmation",["services/appsecurity","durandal/plugins/router","services/utils","services/errorhandler"],function(e,t,n,r){var o=ko.observable(),i=ko.observable().extend({required:!0}),a=ko.observable().extend({required:!0,email:!0}),s=ko.observable(),l=ko.observable(),c={DisplayName:o,UserName:i,Email:a,ExternalLoginData:s,ReturnUrl:l,activate:function(){var t=this;return e.getExternalLoginConfirmationData(n.getURLParameter("returnurl"),n.getURLParameter("username"),n.getURLParameter("provideruserid"),n.getURLParameter("provider")).then(function(e){t.DisplayName(e.DisplayName),t.UserName(e.UserName.split("@")[0]),t.Email(e.UserName),t.ExternalLoginData(e.ExternalLoginData),t.ReturnUrl(e.ReturnUrl)}).fail(t.handlevalidationerrors)},confirmexternalaccount:function(){var n=this;return 0!=this.errors().length?(this.errors.showAllMessages(),void 0):(e.confirmExternalAccount(n.DisplayName(),n.UserName(),n.Email(),n.ExternalLoginData()).then(function(){t.navigateTo("/#/"+n.ReturnUrl())}).fail(n.handlevalidationerrors),void 0)}};return r.includeIn(c),c.errors=ko.validation.group(c),c}),n("viewmodels/account/externalloginfailure",[],function(){return{}}),n("viewmodels/account/login",["services/appsecurity","durandal/plugins/router","services/utils","services/errorhandler"],function(e,t,n,r){var o=ko.observable().extend({required:!0}),i=ko.observable().extend({required:!0,minLength:6}),a=ko.observable(),s=ko.observable(),l=ko.observable(!1);ko.observable(!1);var c={username:o,password:i,rememberMe:a,returnUrl:s,isRedirect:l,appsecurity:e,activate:function(){var t=n.getURLParameter("redirectto");return"null"!=t&&this.isRedirect(!0),this.returnUrl("null"!=t?t:"account"),e.getExternalLogins().then(function(t){e.externalLogins(t)})},externalLogin:function(t,n){e.externalLogin(n.Provider,this.returnUrl()).fail(self.log(n,!0))},login:function(){if(0!=this.errors().length)return this.errors.showAllMessages(),void 0;var t=new e.credential(this.username(),this.password(),this.rememberMe()||!1),n=this;e.login(t,n.returnUrl()).fail(n.handlevalidationerrors)},logout:function(){e.logout()},socialIcon:function(e){var t="";switch(e.Provider.toLowerCase()){case"facebook":t="icon-facebook-sign";break;case"twitter":t="icon-twitter-sign";break;case"google":t="icon-google-plus-sign";break;case"microsoft":t="icon-envelope";break;default:t="icon-check-sign"}return t}};return r.includeIn(c),c.errors=ko.validation.group(c),c}),n("viewmodels/account/register",["services/appsecurity","durandal/plugins/router","services/errorhandler"],function(e,t,n){var r=ko.observable().extend({required:!0}),o=ko.observable().extend({required:!0,email:!0}),i=ko.observable().extend({required:!0,minLength:6}),a=ko.observable().extend({required:!0,minLength:6,equal:i}),s={username:r,email:o,password:i,confirmpassword:a,register:function(){var t=this;return 0!=this.errors().length?(this.errors.showAllMessages(),void 0):(e.register(this.username(),this.email(),this.password(),this.confirmpassword()).fail(t.handlevalidationerrors),void 0)}};return n.includeIn(s),s.errors=ko.validation.group(s),s}),n("viewmodels/admin/admin",[],function(){return{displayName:"admin",description:"admin"}}),n("viewmodels/home/home",[],function(){return{}}),n("viewmodels/user/user",[],function(){return{displayName:"user",description:"user"}}),n("text!views/shell.html",[],function(){return' <div class="navbar navbar-fixed-top">\r\n       <div class="navbar-inner">\r\n             <div>\r\n              <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">\r\n                <span class="icon-bar"></span>\r\n                <span class="icon-bar"></span>\r\n                <span class="icon-bar"></span>\r\n              </a>\r\n                 <a class="brand" href="/#/">DurandalAuth</a>                   \r\n                   <div class="nav-collapse collapse">\r\n                        <ul class="nav" data-bind="foreach: router.visibleRoutes">\r\n                            <li data-bind="css: { active: isActive }">\r\n                                <a data-bind="attr: { href: hash }, html: name"></a>\r\n                            </li>\r\n                        </ul>\r\n                        <ul class="nav pull-right" data-bind="with: appsecurity.user">\r\n                           <li data-bind="if: !IsAuthenticated">\r\n                                    <a href="/#/login">Login</a>\r\n                           </li>\r\n                            <li class="dropdown" data-bind="if: IsAuthenticated">\r\n                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">\r\n                                        Hi <span data-bind="    text: UserName"></span>\r\n                                      <b class="caret"></b>\r\n                                </a>                                \r\n                                <ul class="dropdown-menu">\r\n                                  <li><a href="/#/account">Manage Profile</a></li>\r\n                                  <li class="divider"></li>\r\n                                  <li><a href="#" data-bind="click: $parent.logout">Logout</a></li>\r\n                                </ul>\r\n                          </li>\r\n                        </ul>\r\n                   </div>\r\n          </div>\r\n       </div>\r\n </div>\r\n   \r\n<div class="container-fluid page-host">\r\n        <!--ko compose: { \r\n            model: router.activeItem, //wiring the router\r\n            afterCompose: router.afterCompose, //wiring the router\r\n            transition:\'entrance\', //use the \'entrance\' transition when switching views\r\n            cacheViews:true //telling composition to keep views in the dom, and reuse them (only a good idea with singleton view models)\r\n        }--><!--/ko-->\r\n</div>'}),n("text!views/account/account.html",[],function(){return'<div class="row-fluid">\r\n    <div class="span12 well">        \r\n        <form class="form-horizontal" data-bind="if :  hasAccount, submit : changePassword">\r\n            <h2> Change Password </h2>\r\n            <div class="control-group" data-bind="validationElement: oldPassword">\r\n                <label class="control-label" for="username">Old Password</label>\r\n                    <div class="controls">\r\n                        <input type="password"  data-bind="value: oldPassword" placeholder="Old Password">                       \r\n                    </div>\r\n             </div>                   \r\n             <div class="control-group" data-bind="validationElement: newPassword">\r\n                   <label class="control-label" for="newPassword">New Password</label>\r\n                   <div class="controls">\r\n                        <input type="password"  data-bind="value: newPassword" placeholder="New Password">                        \r\n                    </div>\r\n              </div>  \r\n             <div class="control-group" data-bind="validationElement: confirmNewPassword">\r\n                   <label class="control-label" for="confirmNewPassword">Confirm new Password</label>\r\n                   <div class="controls">\r\n                        <input type="password"  data-bind="value: confirmNewPassword" placeholder="Confirm New Password">                        \r\n                    </div>\r\n              </div>                                                      \r\n              <div class="form-actions">\r\n                    <button type="submit" class="btn btn-primary">Change password</button>\r\n                    <button type="reset" class="btn">Reset</button>                     \r\n               </div>                               \r\n       </form>  \r\n       <form class="form-horizontal" data-bind="if: !hasAccount(), submit: createLocalAccount">\r\n            <h2> Create Local Account </h2>\r\n             <div class="control-group" data-bind="validationElement: newPassword">\r\n                   <label class="control-label" for="newPassword">New Password</label>\r\n                   <div class="controls">\r\n                        <input type="password"  data-bind="value: newPassword" placeholder="New Password">                        \r\n                    </div>\r\n              </div>  \r\n             <div class="control-group" data-bind="validationElement: confirmNewPassword">\r\n                   <label class="control-label" for="confirmNewPassword">Confirm new Password</label>\r\n                   <div class="controls">\r\n                        <input type="password"  data-bind="value: confirmNewPassword" placeholder="Confirm New Password">                        \r\n                    </div>\r\n              </div>                                                      \r\n              <div class="form-actions">\r\n                    <button type="submit" class="btn btn-primary">Create local account</button>\r\n                    <button type="reset" class="btn">Reset</button>                     \r\n               </div>                               \r\n       </form>  \r\n    </div>\r\n\r\n    <div class="span6">\r\n\r\n    </div>\r\n\r\n</div>'}),n("text!views/account/externalloginconfirmation.html",[],function(){return'<h2>Associate your <span data-bind="text: DisplayName"></span></h2>\r\n<p>\r\n    You\'ve successfully authenticated with <span data-bind="text: DisplayName"></span>.\r\n    Please enter a user name for this site below and click the Confirm button to finish\r\n    logging in.\r\n</p>\r\n<form class="form-horizontal" data-bind="submit: confirmexternalaccount">\r\n  <div class="control-group" data-bind="validationElement: UserName">\r\n    <label class="control-label" for="UserName">User name</label>\r\n    <div class="controls">\r\n      <input type="text" data-bind="value: UserName" placeholder="User name">\r\n    </div>\r\n  </div>\r\n  <div class="control-group" data-bind="validationElement: Email">\r\n    <label class="control-label" for="Email">User name</label>\r\n    <div class="controls">\r\n      <input type="text" data-bind="value: Email" placeholder="Email">\r\n    </div>\r\n  </div>\r\n  <button type="submit" class="btn btn-primary" >Register</button>\r\n</form>'}),n("text!views/account/externalloginfailure.html",[],function(){return"<h2>Unsuccessful login with service.</h2>"}),n("text!views/account/login.html",[],function(){return'<div class="row-fluid" data-bind="visible: !appsecurity.user().IsAuthenticated">\r\n    <div class="offset1 span5">\r\n        <div class="well">                \r\n           <!-- Login form  -->\r\n           <form>\r\n               <!-- Username -->\r\n               <div class="control-group" data-bind="validationElement: username">\r\n                 <label class="control-label" for="username">Username</label>\r\n                 <div class="controls">\r\n                    <input type="text"  data-bind="value: username" placeholder="User name">                       \r\n                 </div>\r\n               </div>\r\n               <!-- Password -->\r\n               <div class="control-group" data-bind="validationElement: password">\r\n                 <label class="control-label" for="email">Password</label>\r\n                 <div class="controls">\r\n                    <input type="password"  data-bind="value: password" placeholder="Password">                        \r\n                 </div>\r\n               </div>  \r\n              <div class="control-group">\r\n                <div class="controls">\r\n                  <label class="checkbox">\r\n                    <input type="checkbox" data-bind="value: rememberMe"> Remember me\r\n                  </label>                      \r\n                </div>     \r\n                </div>                                                                                      \r\n                <div class="form-actions">\r\n                    <button type="submit" class="btn btn-primary" data-bind="click: login">Sign in</button>\r\n                    <button type="reset" class="btn">Reset</button>\r\n                    <p class="mart5">Don\'t have Account? <a href="/#/register">Register</a></p>\r\n                </div>                   \r\n           </form>                      \r\n        </div> \r\n    </div>\r\n    \r\n    <div class="span5">\r\n        <div class="well">\r\n            <h3>Login using another service</h3>\r\n            <ul class="unstyled" data-bind="foreach : appsecurity.externalLogins">\r\n                    <li>\r\n                        <a class="lead" href="#"  data-bind="click: function (data, event) { $parent.externalLogin($parent, data, event) }, attr: { \'data-provider\': Provider }">\r\n                        <i data-bind="css: $parent.socialIcon($data)"></i>\r\n                        <span data-bind="text: ProviderDisplayName"></span>\r\n                    </a>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n    </div>    \r\n</div>\r\n  \r\n<div class="row-fluid" data-bind="visible: appsecurity.user().IsAuthenticated && !isRedirect()">\r\n    <h2>You are actually logged in</h2>\r\n    <a class="btn btn-primary" data-bind="click : logout">Logout</a>\r\n</div>\r\n\r\n<div class="row-fluid" data-bind="visible: appsecurity.user().IsAuthenticated && isRedirect()">\r\n    <h2>You are actually logged in but cannot access this route with your current permissions</h2>\r\n    <p class="lead">Sign out and enter again the credentials with the correct permissions</p>\r\n    <a class="btn btn-primary" data-bind="click: logout">Logout</a>\r\n</div>'}),n("text!views/account/register.html",[],function(){return'<div class="row-fluid">\r\n       <div class="offset3 span6">\r\n            <div class="well">                \r\n               <!-- Login form  -->\r\n               <form class="form-horizontal" data-bind="submit :  register">\r\n                   <!-- Username -->\r\n                   <div class="control-group" data-bind="validationElement: username">\r\n                     <label class="control-label" for="username">Username</label>\r\n                     <div class="controls">\r\n                        <input type="text"  data-bind="value: username" placeholder="User name">      \r\n                     </div>\r\n                   </div>\r\n                   <!-- Username -->\r\n                   <div class="control-group" data-bind="validationElement: email">\r\n                     <label class="control-label" for="username">Email</label>\r\n                     <div class="controls">\r\n                        <input type="text"  data-bind="value: email" placeholder="Email"> \r\n                     </div>\r\n                   </div>\r\n                   <!-- Password -->\r\n                   <div class="control-group" data-bind="validationElement: password">\r\n                     <label class="control-label" for="email">Password</label>\r\n                     <div class="controls">\r\n                        <input type="password"  data-bind="value: password" placeholder="Password">  \r\n                     </div>\r\n                   </div>  \r\n                   <div class="control-group" data-bind="validationElement: confirmpassword">\r\n                     <label class="control-label" for="email">ConfirmPassword</label>\r\n                     <div class="controls">\r\n                        <input type="password"  data-bind="value: confirmpassword" placeholder="Confirm Password">  \r\n                     </div>\r\n                   </div>  \r\n                   <div class="form-actions">\r\n                     <button type="submit" class="btn btn-primary">Register</button>\r\n                     <button type="reset" class="btn">Reset</button>\r\n                   </div>                   \r\n               </form>                      \r\n             </div> \r\n       </div>          \r\n  </div>\r\n '}),n("text!views/admin/admin.html",[],function(){return'<h1>Congratulations!!</h1>\r\n<p class="lead">You manage yourself for entering this restricted route</p>\r\n<p>Route restricted to users in role "Administrator"</p>'}),n("text!views/home/home.html",[],function(){return'<h2>Welcome to the Durandal auth authentication template</h2>\r\n<p class="lead">This template pretend to be a port from the default ASP MVC 4 Internet template, providing forms and oAuth authentication with the main providers</p>\r\n<p>Try to sign in for a new account using the <a href="/#/login">membership system or the oAuth providers</a>.</p>\r\n<p>A role "User" will be asigned to any new user and will allow access to the <a href="/#/user">User view</a>.</p>\r\n<p>If you want to access to the <a href="/#/admin">Admin view</a> you need the role "Administrator" so you can only acccess to it with an admin user. Try to log in with the followind one admin/admin1234</p>\r\n\r\n<div class="alert alert-info">\r\n    <h2>Important !!</h2>\r\n    <p class="lead">The authorization system in the client can be always be hacked, so remember to always authenticate and authorize the request in the server when retrieving the necessary data for your views</p>\r\n</div>'}),n("text!views/user/user.html",[],function(){return'<h1>Congratulations!!</h1>\r\n<p class="lead">You manage yourself for entering this restricted route</p>\r\n<p>Route restricted to users in role "User"</p>'}),t(["main"])})();